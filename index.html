<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Untuk Safna ğŸ¤</title>

<style>
html, body{
    margin:0;
    padding:0;
    height:100%;
}

body{
    font-family: Arial, sans-serif;
    text-align:center;
    background: linear-gradient(135deg, #ffdde1, #ee9ca7);
    background-attachment: fixed;
    color:white;
    overflow:hidden;
}

/* LOGIN */
#login{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
}

input{
    padding:12px;
    border:none;
    border-radius:12px;
    text-align:center;
    width:200px;
}

button{
    padding:10px 20px;
    border:none;
    border-radius:25px;
    cursor:pointer;
    margin-top:10px;
    font-size:14px;
}

/* CLUE FIXED */
#secretClue{
    position:fixed;
    bottom:25px;
    right:25px;
    opacity:0.35;
    animation:blink 1.5s infinite;
    font-size:18px;
    cursor:pointer;
    z-index:9999;
    user-select:none;
}

@keyframes blink{
    0%{opacity:0.2;}
    50%{opacity:1;}
    100%{opacity:0.2;}
}

/* LOADING */
#loading{
    display:none;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
}

#progressBar{
    width:220px;
    height:20px;
    background:white;
    border-radius:20px;
    overflow:hidden;
    margin:auto;
}

#progress{
    height:100%;
    width:0%;
    background:hotpink;
}

/* MAIN */
#main{
    display:none;
    padding-top:40px;
}

#finalHeart{
    font-size:40px;
    position:absolute;
}

#cakeSection{
    display:none;
    margin-top:30px;
}

#birthdayFinalMessage{
    display:none;
    margin:20px;
    white-space:pre-line;
    font-size:18px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
    <h2>Masukkan Password ğŸ’›</h2>
    <input type="password" id="password">
    <br>
    <button onclick="checkPassword()">Masuk</button>
</div>

<div id="secretClue">ğŸ’› S F</div>

<!-- LOADING -->
<div id="loading">
    <h3>Sabar ya Safna ğŸ˜†</h3>
    <div id="progressBar">
        <div id="progress"></div>
    </div>
    <p>Miringkan HP biar makin cepat ğŸ˜‰</p>
    <button onclick="enableSensor()">Aktifkan Sensor Cinta ğŸ’›</button>
</div>

<!-- MAIN -->
<div id="main">

    <h1>Selamat Datang Safna ğŸ¤</h1>

    <h2>ğŸ¯ Klik hati 15 kali ya ğŸ˜†</h2>
    <button id="finalHeart">ğŸ’–</button>
    <p>Score: <span id="finalScore">0</span></p>

    <div id="cakeSection">
        <h2>ğŸ‚ Tiup Lilinnya ğŸ‚</h2>
        <div style="font-size:80px;">ğŸ‚</div>
        <div id="candle" style="font-size:40px;">ğŸ•¯ï¸</div>
        <button onclick="startMic()">Tiup Sekarang ğŸ¤</button>
    </div>

    <div id="birthdayFinalMessage"></div>

</div>

<audio id="birthdaySong" loop>
<source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" type="audio/mpeg">
</audio>

<script>

/* PASSWORD */
function checkPassword(){
    if(document.getElementById("password").value==="SayangFikri"){
        document.getElementById("login").style.display="none";
        document.getElementById("secretClue").style.display="none";
        document.getElementById("loading").style.display="block";
    }else{
        alert("Clue nya ada inisialnya ğŸ˜Œ");
    }
}

/* CLUE CLICK */
let tapCount = 0;
document.getElementById("secretClue").addEventListener("click", function(){
    tapCount++;
    if(tapCount < 3){
        alert("Clue kecil: gabungan kata manis + namamu ğŸ˜");
    }else{
        alert("Oke oke... ada kata 'Sayang' di depannya ğŸ˜†");
    }
});

/* LOADING SENSOR */
/* LOADING SENSOR FIX ALL HP */
let progress = 0;

async function enableSensor() {

    // iPhone / iOS fix
    if (typeof DeviceOrientationEvent !== "undefined" &&
        typeof DeviceOrientationEvent.requestPermission === "function") {
        try {
            const permission = await DeviceOrientationEvent.requestPermission();
            if (permission !== "granted") {
                alert("Izinkan sensor dulu ya ğŸ˜†");
                return;
            }
        } catch (e) {
            alert("Sensor tidak didukung ğŸ˜¢");
            return;
        }
    }

    window.addEventListener("deviceorientation", handleOrientation);
    alert("Sensor aktif! Sekarang miringkan HP ğŸ˜");
}

function handleOrientation(event) {

    let tilt = event.gamma;

    if (tilt > 10) {
        progress += 2;
    } else if (tilt < -10) {
        progress += 0.5;
    }

    if (progress > 100) progress = 100;

    document.getElementById("progress").style.width = progress + "%";

    if (progress >= 100) {
        finishLoading();
    }

    if (Math.abs(tilt) > 45) {
        alert("WOI jangan dibalik ğŸ˜†");
    }
}

/* GAME */
let score=0;
let target=15;
const heart=document.getElementById("finalHeart");

heart.onclick=function(){
    score++;
    document.getElementById("finalScore").innerText=score;

    heart.style.top=Math.random()*window.innerHeight+"px";
    heart.style.left=Math.random()*window.innerWidth+"px";

    if(score>=target){
        document.getElementById("cakeSection").style.display="block";
    }
};

/* MIC BLOW */
async function startMic(){
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    const audioContext=new(window.AudioContext||window.webkitAudioContext)();
    const mic=audioContext.createMediaStreamSource(stream);
    const analyser=audioContext.createAnalyser();
    mic.connect(analyser);
    analyser.fftSize=256;
    const data=new Uint8Array(analyser.frequencyBinCount);

    function detect(){
        analyser.getByteFrequencyData(data);
        let volume=data.reduce((a,b)=>a+b)/data.length;

        if(volume>60){
            document.getElementById("candle").innerHTML="ğŸ’¨";
            stream.getTracks().forEach(track=>track.stop());
            showMessage();
            return;
        }
        requestAnimationFrame(detect);
    }

    detect();
}

/* FINAL MESSAGE */
function showMessage(){
    document.getElementById("cakeSection").style.display="none";
    let message=`Selamat ulang tahun ya, Safna ğŸ¤
Semoga semua doa baik yang kamu simpan diam-diam satu per satu jadi nyata.

Semoga kamu selalu dikelilingi hal-hal yang bikin kamu senyumâ€¦
walaupun jujur, aku berharap aku bisa jadi salah satu alasannya ğŸ˜Œâœ¨

Hari ini Safna bertambah umur,
tapi tenang ajaâ€¦ kamu tetap manis kok, nggak nambah tua, cuma nambah spesial buat aku ğŸ’›`;

    let box=document.getElementById("birthdayFinalMessage");
    box.style.display="block";
    box.innerText=message;
}

</script>

</body>
</html>
